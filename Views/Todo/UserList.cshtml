@model IEnumerable<TodoListApp.Models.User>

@{
    ViewData["Title"] = "User List";
}

<div class="dashboard-container fade-in">
    <div class="dashboard-header" style="justify-content: space-between; display: flex; align-items: center;">
        <div>
            <h1>User List</h1>
            <p class="subtitle">Registered users in the system</p>
        </div>
        <a asp-action="CreateUser" class="btn-glow-primary">
            <span>+</span> Create New User
        </a>
    </div>

    <div class="todo-card" style="margin-top: 2rem;">
        <div class="search-container-lite" style="margin-bottom: 1.5rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.6;"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" class="search-input-lite" placeholder="Search users by name or email..." id="userSearchInput" onkeyup="filterUsers()">
        </div>

        <table class="table table-hover" id="userTable">
            <thead>
                <tr>
                    <th class="text-left">User ID</th>
                    <th class="text-left">Full Name</th>
                    <th class="text-left">Email</th>
                    <th class="text-left">Password Hash</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr>
                        <td>@user.Id</td>
                        <td>@(user.Name ?? "N/A")</td>
                        <td>@user.Email</td>
                        <td class="cell-truncate" title="@user.Password">@user.Password</td>
                        <td class="text-right">
                            <a asp-action="EditUser" asp-route-id="@user.Id" class="btn-edit-unique" style="margin-right: 5px;">Edit</a>
                            <form asp-action="DeleteUser" asp-route-id="@user.Id" method="post" style="display:inline;" onsubmit="return confirm('Are you sure?');">
                                <button type="submit" class="btn-delete-unique">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    function filterUsers() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("userSearchInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("userTable");
        tr = table.getElementsByTagName("tr");

        for (i = 0; i < tr.length; i++) {
            // Search Name (col 1) and Email (col 2)
            // Note: Indices depend on table structure. 
            // Previous view showed: ID(0), Name(1), Email(2), Password(3), Actions(4)
            var tdName = tr[i].getElementsByTagName("td")[1];
            var tdEmail = tr[i].getElementsByTagName("td")[2];
            
            if (tdName || tdEmail) {
                var txtValueName = tdName ? (tdName.textContent || tdName.innerText) : "";
                var txtValueEmail = tdEmail ? (tdEmail.textContent || tdEmail.innerText) : "";
                
                if (txtValueName.toUpperCase().indexOf(filter) > -1 || txtValueEmail.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
</script>

